# Mock backend server for testing (plain nginx - no Lua)

server {
    listen 8080;
    server_name _;

    # Health check endpoint
    location /health {
        access_log off;
        default_type application/json;
        return 200 '{"status":"healthy","service":"backend"}';
    }

    # Echo endpoint - shows received WAF headers
    location /echo {
        default_type application/json;
        return 200 '{"status":"ok","endpoint":"echo","waf_headers":{"form_hash":"$http_x_form_hash","spam_score":"$http_x_spam_score","spam_flags":"$http_x_spam_flags","client_ip":"$http_x_client_ip"}}';
    }

    # Form submission endpoint
    location /submit {
        default_type application/json;
        return 200 '{"status":"success","message":"Form submitted successfully","waf_headers":{"form_hash":"$http_x_form_hash","spam_score":"$http_x_spam_score","spam_flags":"$http_x_spam_flags"}}';
    }

    # Contact form endpoint
    location /contact {
        default_type application/json;
        return 200 '{"status":"success","message":"Contact form received"}';
    }

    # Catch-all
    location / {
        default_type application/json;
        return 200 '{"status":"ok","endpoint":"default"}';
    }
}
