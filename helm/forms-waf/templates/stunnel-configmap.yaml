{{- if and (not .Values.redis.enabled) .Values.externalRedis.tls.enabled }}
apiVersion: v1
kind: ConfigMap
metadata:
  name: {{ include "forms-waf.fullname" . }}-stunnel-config
  labels:
    {{- include "forms-waf.labels" . | nindent 4 }}
data:
  stunnel.conf: |
    ; stunnel configuration for Redis TLS proxy
    foreground = yes
    pid =

    [redis]
    client = yes
    accept = 127.0.0.1:{{ .Values.externalRedis.tls.stunnel.localPort | default 6379 }}
    connect = {{ .Values.externalRedis.host }}:{{ .Values.externalRedis.port | default 6379 }}
    {{- if .Values.externalRedis.tls.stunnel.extraOptions }}
    {{ .Values.externalRedis.tls.stunnel.extraOptions | nindent 4 }}
    {{- end }}
{{- end }}
